(this["webpackJsonpspex-webapp-react"]=this["webpackJsonpspex-webapp-react"]||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),s=a(3),r=a.n(s);a(13),a(14);var o=function(e){let{taskType:t,updateConfig:a}=e;return l.a.createElement("div",{id:"task-container"},l.a.createElement("h3",null,"Select a Task"),l.a.createElement("div",{className:"image-selection-grid"},l.a.createElement("button",{type:"button",className:"task-button "+("image"===t?"selected":""),onClick:()=>a("task","image")},l.a.createElement("span",{role:"img","aria-label":"image"},"\ud83d\uddbc\ufe0f")," Image"),l.a.createElement("button",{type:"button",className:"task-button "+("text"===t?"selected":""),onClick:()=>a("task","text")},l.a.createElement("span",{role:"img","aria-label":"text"},"\ud83d\udcc4")," Text")))};var c=function(e){let{selectedContextId:t,numContexts:a,taskType:n,contextText:s,updateConfig:r}=e;return n?"image"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select an Image"),l.a.createElement("div",{className:"image-selection-grid",id:"image-context-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("div",{key:e,className:"context-image-button "+(t===e?"selected":""),onClick:()=>r("selectedContextID",e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${e}.png`,alt:"Option"}))))):"text"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select a Context"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"context-text-button "+(t===e?"selected":""),onClick:()=>r("selectedContextID",e)},s[e])))):null:null};var i=function(e){let{selectedPromptId:t,numPrompts:a,taskType:n,promptText:s,updateConfig:r}=e;return n&&null!==a?l.a.createElement("div",{id:"prompt-container"},l.a.createElement("h3",null,"Select a Prompt"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"prompt-button "+(t===e?"selected":""),onClick:()=>r("selectedPromptID",e)},s[e])))):null};var m=function(e){let{config:t,updateConfig:a}=e;return l.a.createElement("div",{className:"sidebar"},l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"sunglasses"},"\ud83d\udd76\ufe0f")," SPEX"),l.a.createElement(o,{taskType:t.task,updateConfig:a}),l.a.createElement(c,{selectedContextId:t.selectedContextID,numContexts:t.numContexts,taskType:t.task,contextText:t.contextText,updateConfig:a}),l.a.createElement(i,{selectedPromptId:t.selectedPromptID,numPrompts:t.numPrompts,taskType:t.task,promptText:t.promptText,updateConfig:a}))};var u=e=>{let{prompt:t,response:a}=e;const[s,r]=Object(n.useState)(t),[o,c]=Object(n.useState)(a);return Object(n.useEffect)(()=>{r(t),c(a)},[t,a]),l.a.createElement("div",{className:"chatbox"},l.a.createElement("div",{className:"messages"},l.a.createElement("div",{className:"user_message"},l.a.createElement("div",{className:"message_title"},"Prompt"),s),l.a.createElement("div",{className:"bot_message"},l.a.createElement("div",{className:"message_title",style:{display:"flex",alignItems:"center"}},l.a.createElement("img",{src:"/spex-webapp/assets/meta-logo.png",alt:"Llama-3.2 Logo",style:{height:"15px",marginRight:"5px"}})," Llama-3.2"),o)))};var d=function(e){let{config:t,changeSelection:a}=e;const{task:n,selectedContextID:s,numFeatures:r}=t;if(!n||null===s)return null;var o=l.a.createElement("div",{className:"main-content"});if("image"===n)return o=l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"grid-container"},l.a.createElement("div",{className:"message_title"}," Context "),[...Array(r).keys()].map(e=>l.a.createElement("div",{key:e,className:"patch",id:"patch-"+e,onClick:()=>a(e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${s}/split_${e}.png`,alt:"Part"}),l.a.createElement("div",{className:"patch-overlay"}),l.a.createElement("div",{className:"patch-text",style:{visibility:"hidden"}})))),l.a.createElement(u,null));if("text"===n)o=l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"text-container"},l.a.createElement("div",{className:"message_title"}," Context "),[...Array(r).keys()].map(e=>l.a.createElement("div",{key:e,className:"token-wrapper",id:"token-"+e,onClick:()=>a(e),style:{visibility:"hidden",display:"block"}},l.a.createElement("div",{className:"token-text"},"0"),l.a.createElement("span",{className:"inline-token"})))),null!==t.selectedPromptID&&l.a.createElement(u,{prompt:t.promptText[t.selectedPromptID],response:t.responseText[t.selectedPromptID]}));return o};function p(e,t,a,n){function l(e){let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]}e=Math.max(-1,Math.min(1,e));let s,r,o,c=l(a),i=l(t),m=l(n),u=(e+1)/2;return u<.5?(u*=2,s=Math.round(i[0]+(m[0]-i[0])*u),r=Math.round(i[1]+(m[1]-i[1])*u),o=Math.round(i[2]+(m[2]-i[2])*u)):(u=2*(u-.5),s=Math.round(m[0]+(c[0]-m[0])*u),r=Math.round(m[1]+(c[1]-m[1])*u),o=Math.round(m[2]+(c[2]-m[2])*u)),function(e,t,a){return"#"+(1<<24|e<<16|t<<8|a).toString(16).slice(1).toUpperCase()}(s,r,o)}var g=function(){const[e,t]=Object(n.useState)({contextData:null,task:null,selectedContextID:null,selectedPromptID:null,numContexts:null,contextText:[],numPrompts:null,promptText:[],responseText:[],tokens:[],numFeatures:12,triggerTokenSet:!1,triggerFetchCoefficients:!1,triggerFeatureValueCalculation:!1,triggerTokenVisualization:!1}),[a,s]=Object(n.useState)({coefficients:null,selectedFeatures:new Set,featureValues:null});return Object(n.useEffect)(()=>{fetch("/spex-webapp/assets/config.json").then(e=>e.json()).then(e=>{t(t=>({...t,contextData:e}))})},[]),Object(n.useEffect)(()=>{e.triggerTokenSet&&(console.log("token set"),e.triggerTokenSet=!1,function(e){for(let t=0;t<""+e.length;t++){let a=document.getElementById("token-"+t);a.getElementsByClassName("inline-token")[0].textContent=e[t],a.style.visibility="visible"}}(e.tokens))},[e.triggerTokenSet,e.tokens]),Object(n.useEffect)(()=>{e.triggerFetchCoefficients&&(console.log("fetch coefficients"),e.triggerFetchCoefficients=!1,async function(e,t,a){const n=await fetch(`/spex-webapp/assets/spex/${e}/context_${t}/prompt_${a}.json`);return await n.json()}(e.task,e.selectedContextID,e.selectedPromptID).then(e=>{s(t=>({coefficients:e,selectedFeatures:new Set,featureValues:null})),t(e=>({...e,triggerFeatureValueCalculation:!0}))}))},[e.triggerFetchCoefficients,e.task,e.selectedContextID,e.selectedPromptID]),Object(n.useEffect)(()=>{e.triggerFeatureValueCalculation&&(console.log("calculate feature values"),e.triggerFeatureValueCalculation=!1,async function(e,t,a){let n=new Array(a).fill(0),l={};for(let c in e){var s="0".repeat(a).split(""),r=e[c];for(let e=0;e<a;e++)"1"===c[e]&&(t.has(e)?r*=-1:s[e]="1");l[s=s.join("")]=s in l?l[s]+r:r}for(let c in l)for(let e=0;e<a;e++)"1"===c[e]&&(n[e]+=l[c]**2);let o=Math.max(...n);return n=0!==o?n.map(e=>e/o):n.map(e=>0),n}(a.coefficients,a.selectedFeatures,e.numFeatures).then(e=>{s(t=>({...t,featureValues:e})),t(e=>({...e,triggerTokenVisualization:!0}))}))},[e.triggerFeatureValueCalculation,a.coefficients,a.selectedFeatures,e.numFeatures]),Object(n.useEffect)(()=>{e.triggerTokenVisualization&&(console.log("visualize tokens"),e.triggerTokenVisualization=!1,"text"===e.task?function(e,t,a,n){for(let s=0;s<""+e;s++){let e=document.getElementById("token-"+s),r=e.getElementsByClassName("inline-token")[0],o=e.getElementsByClassName("token-text")[0],c=getComputedStyle(document.documentElement),i=c.getPropertyValue("--overlay-positive-color").trim(),m=c.getPropertyValue("--overlay-negative-color").trim(),u=c.getPropertyValue("--overlay-default-color").trim(),d=c.getPropertyValue("--border-selected-color").trim();c.getPropertyValue("--border-default-color").trim();if(n)if(t.has(s))o.textContent="",o.style.visibility="hidden",r.style.backgroundColor=d+"60",r.style.border="3px solid "+d;else{o.textContent=a[s].toFixed(2),o.style.visibility="visible";var l=p(a[s],m,i,u);r.style.backgroundColor=l+"60",r.style.border="3px solid "+l,o.style.color=""+l}else o.textContent="",o.style.visibility="hidden",r.style.backgroundColor=u+"60",r.style.border="3px solid "+u}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID):"image"===e.task&&function(e,t,a,n){for(let s=0;s<""+e;s++){let e=document.getElementById("patch-"+s),r=e.querySelector("img"),o=e.getElementsByClassName("patch-overlay")[0],c=e.getElementsByClassName("patch-text")[0],i=getComputedStyle(document.documentElement),m=i.getPropertyValue("--overlay-positive-color").trim(),u=i.getPropertyValue("--overlay-negative-color").trim(),d=i.getPropertyValue("--overlay-default-color").trim(),g=i.getPropertyValue("--border-selected-color").trim(),x=i.getPropertyValue("--border-default-color").trim();if(n)if(t.has(s))c.textContent="",c.style.visibility="hidden",r.style.border="6px solid "+g,o.style.border="6px solid "+g,o.style.backgroundColor=d+"60";else{c.textContent=a[s].toFixed(2),c.style.visibility="visible";var l=p(a[s],u,m,d);r.style.border="6px solid "+l,o.style.border="6px solid "+l,c.style.color=""+l,o.style.backgroundColor=l+"60"}else c.textContent="",c.style.visibility="hidden",r.style.border="6px solid "+x,o.style.border="6px solid "+x,o.style.backgroundColor="#00000000"}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID))},[e.triggerTokenVisualization,e.task,e.numFeatures,a.selectedFeatures,a.featureValues,e.selectedPromptID]),l.a.createElement("div",{className:"App"},l.a.createElement(m,{config:e,updateConfig:(e,a)=>{t(t=>{const n={...t,[e]:a};if("task"===e){const e=n.contextData[a];n.numContexts=e.length,n.contextText=e.map(e=>e.context_title),n.selectedContextID=null,n.selectedPromptID=null,n.numPrompts=null,n.promptText=[]}if("selectedContextID"===e){const e=n.contextData[n.task][a];n.numPrompts=e.prompts.length,n.promptText=e.prompts,n.responseText=e.responses,n.selectedPromptID=null,"text"===n.task?(n.tokens=e.context.split(" "),n.numFeatures=n.tokens.length):"image"===n.task&&(n.tokens=[],n.numFeatures=12),n.triggerTokenSet=!0,n.triggerTokenVisualization=!0}return"selectedPromptID"===e&&(n.triggerFetchCoefficients=!0),n})}}),l.a.createElement(d,{config:e,changeSelection:t=>{if(null!==e.selectedContextID&&null!==e.selectedPromptID){const e=a.selectedFeatures.has(t);s(a=>{if(null===t)return a;const n={...a,selectedFeatures:new Set(a.selectedFeatures)};return e?n.selectedFeatures.delete(t):n.selectedFeatures.add(t),n})}e.triggerFeatureValueCalculation=!0}}))};var x=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,16)).then(t=>{let{getCLS:a,getFID:n,getFCP:l,getLCP:s,getTTFB:r}=t;a(e),n(e),l(e),s(e),r(e)})};r.a.createRoot(document.getElementById("root")).render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(g,null))),x()},4:function(e,t,a){e.exports=a(15)}},[[4,1,2]]]);
//# sourceMappingURL=main.15ef29d8.chunk.js.map