(this["webpackJsonpspex-webapp-react"]=this["webpackJsonpspex-webapp-react"]||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(3),s=a.n(r);a(13),a(14);var o=function(e){let{taskType:t,updateConfig:a}=e;return l.a.createElement("div",{id:"task-container"},l.a.createElement("h3",null,"Select a Task"),l.a.createElement("div",{className:"image-selection-grid"},l.a.createElement("button",{type:"button",className:"task-button "+("text"===t?"selected":""),onClick:()=>a("task","text")},l.a.createElement("span",{role:"img","aria-label":"text"},"\ud83d\udcc4")," Text"),l.a.createElement("button",{type:"button",className:"task-button "+("image"===t?"selected":""),onClick:()=>a("task","image")},l.a.createElement("span",{role:"img","aria-label":"image"},"\ud83d\uddbc\ufe0f")," Image")))};var i=function(e){let{selectedContextId:t,numContexts:a,taskType:n,contextText:r,updateConfig:s}=e;return n?"image"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select an Image"),l.a.createElement("div",{className:"image-selection-grid",id:"image-context-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("div",{key:e,className:"context-image-button "+(t===e?"selected":""),onClick:()=>s("selectedContextID",e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${e}/image.png`,alt:"Option"}))))):"text"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select a Context"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"context-text-button "+(t===e?"selected":""),onClick:()=>s("selectedContextID",e)},r[e])))):null:null};var c=function(e){let{selectedPromptId:t,numPrompts:a,taskType:n,promptText:r,updateConfig:s}=e;return n&&null!==a?l.a.createElement("div",{id:"prompt-container"},l.a.createElement("h3",null,"Select a Prompt"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"prompt-button "+(t===e?"selected":""),onClick:()=>s("selectedPromptID",e)},r[e])))):null};var m=()=>l.a.createElement("div",{className:"about"},l.a.createElement("hr",null),l.a.createElement("div",null,"Check out our paper\xa0",l.a.createElement("a",{href:"https://arxiv.org/abs/2502.13870",target:"_blank",rel:"noopener noreferrer"},"SPEX: Scaling Feature Interaction Explanations for LLMs"),"\xa0on ",l.a.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/7/7a/ArXiv_logo_2022.png",alt:"arXiv logo",style:{height:"18px",verticalAlign:"middle"}}),"\xa0and our Python package\xa0",l.a.createElement("a",{href:"https://github.com/basics-lab/spectral-explain",target:"_blank",rel:"noopener noreferrer"},"SPEX"),"\xa0on GitHub ",l.a.createElement("img",{src:"https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg",alt:"Github logo",style:{height:"18px",verticalAlign:"middle"}}),"."),"Developed by ",l.a.createElement("b",null,"Yigit Efe Erginbas"),", Landon Butler, Justin Singh Kang, and Abhineet Agarwal.");var u=function(e){let{config:t,updateConfig:a}=e;return l.a.createElement("div",{className:"sidebar"},l.a.createElement("div",{className:"config"},l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"sunglasses"},"\ud83d\udd76\ufe0f")," SPEX"),l.a.createElement(o,{taskType:t.task,updateConfig:a}),l.a.createElement(i,{selectedContextId:t.selectedContextID,numContexts:t.numContexts,taskType:t.task,contextText:t.contextText,updateConfig:a}),l.a.createElement(c,{selectedPromptId:t.selectedPromptID,numPrompts:t.numPrompts,taskType:t.task,promptText:t.promptText,updateConfig:a})))};var p=e=>{let{prompt:t,response:a}=e;const[r,s]=Object(n.useState)(t),[o,i]=Object(n.useState)(a);return Object(n.useEffect)(()=>{s(t),i(a)},[t,a]),l.a.createElement("div",{className:"chatbox"},l.a.createElement("div",{className:"messages"},l.a.createElement("div",{className:"user_message"},l.a.createElement("div",{className:"message_title"},"Prompt"),r),l.a.createElement("div",{className:"bot_message"},l.a.createElement("div",{className:"message_title",style:{display:"flex",alignItems:"center"}},l.a.createElement("img",{src:"/spex-webapp/assets/meta-logo.png",alt:"Llama-3.2 Logo",style:{height:"15px",marginRight:"5px"}})," Llama-3.2"),o)))};var d=function(e){let{config:t,changeSelection:a}=e;const{task:n,selectedContextID:r,numFeatures:s}=t;return n&&null!==r?"image"===n?l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"image-container"},l.a.createElement("div",{className:"message_title"}," Context "),l.a.createElement("div",{className:"grid-container",style:{gridTemplateColumns:`repeat(${t.numFeatureColumns}, 1fr)`}},[...Array(s).keys()].map(e=>l.a.createElement("div",{key:e,className:"patch",id:"patch-"+e,onClick:()=>a(e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${r}/patches/patch_${e}.png`,alt:"Part"}),l.a.createElement("div",{className:"patch-overlay"}),l.a.createElement("div",{className:"patch-text",style:{visibility:"hidden"}}))))),null!==t.selectedPromptID&&l.a.createElement(p,{prompt:t.promptText[t.selectedPromptID],response:t.responseText[t.selectedPromptID]}),l.a.createElement(m,null)):"text"===n?l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"text-container"},l.a.createElement("div",{className:"message_title"}," Context "),[...Array(s).keys()].map(e=>l.a.createElement("div",{key:e,className:"token-wrapper",id:"token-"+e,onClick:()=>a(e),style:{visibility:"hidden",display:"block"}},l.a.createElement("div",{className:"token-text"},"0"),l.a.createElement("span",{className:"inline-token"})))),null!==t.selectedPromptID&&l.a.createElement(p,{prompt:t.promptText[t.selectedPromptID],response:t.responseText[t.selectedPromptID]}),l.a.createElement(m,null)):null:l.a.createElement("div",{className:"main-content"},l.a.createElement(m,null))};function g(e,t,a,n){function l(e){let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]}e=Math.max(-1,Math.min(1,e));let r,s,o,i=l(a),c=l(t),m=l(n),u=(e+1)/2;return u<.5?(u*=2,r=Math.round(c[0]+(m[0]-c[0])*u),s=Math.round(c[1]+(m[1]-c[1])*u),o=Math.round(c[2]+(m[2]-c[2])*u)):(u=2*(u-.5),r=Math.round(m[0]+(i[0]-m[0])*u),s=Math.round(m[1]+(i[1]-m[1])*u),o=Math.round(m[2]+(i[2]-m[2])*u)),function(e,t,a){return"#"+(1<<24|e<<16|t<<8|a).toString(16).slice(1).toUpperCase()}(r,s,o)}var x=function(){const[e,t]=Object(n.useState)({contextData:null,task:null,selectedContextID:null,selectedPromptID:null,numContexts:null,contextText:[],numPrompts:null,promptText:[],responseText:[],tokens:[],numFeatures:null,numFeatureColumns:null,triggerTokenSet:!1,triggerFetchCoefficients:!1,triggerFeatureValueCalculation:!1,triggerTokenVisualization:!1}),[a,r]=Object(n.useState)({coefficients:null,selectedFeatures:new Set,featureValues:null});return Object(n.useEffect)(()=>{fetch("/spex-webapp/assets/config.json").then(e=>e.json()).then(e=>{t(t=>({...t,contextData:e}))})},[]),Object(n.useEffect)(()=>{e.triggerTokenSet&&(console.log("token set"),e.triggerTokenSet=!1,function(e){for(let t=0;t<""+e.length;t++){let a=document.getElementById("token-"+t);a.getElementsByClassName("inline-token")[0].textContent=e[t],a.style.visibility="visible"}}(e.tokens))},[e.triggerTokenSet,e.tokens]),Object(n.useEffect)(()=>{e.triggerFetchCoefficients&&(console.log("fetch coefficients"),e.triggerFetchCoefficients=!1,async function(e,t,a){const n=await fetch(`/spex-webapp/assets/spex/${e}/context_${t}/prompt_${a}.json`);return await n.json()}(e.task,e.selectedContextID,e.selectedPromptID).then(e=>{r(t=>({coefficients:e,selectedFeatures:new Set,featureValues:null})),t(e=>({...e,triggerFeatureValueCalculation:!0}))}))},[e.triggerFetchCoefficients,e.task,e.selectedContextID,e.selectedPromptID]),Object(n.useEffect)(()=>{e.triggerFeatureValueCalculation&&(console.log("calculate feature values"),e.triggerFeatureValueCalculation=!1,async function(e,t,a){let n=new Array(a).fill(0),l={};for(let i in e){var r="0".repeat(a).split(""),s=e[i];for(let e=0;e<a;e++)"1"===i[e]&&(t.has(e)?s*=-1:r[e]="1");l[r=r.join("")]=r in l?l[r]+s:s}for(let i in l)for(let e=0;e<a;e++)"1"===i[e]&&(n[e]+=l[i]**2);let o=Math.max(...n);return n=0!==o?n.map(e=>e/o):n.map(e=>0),n}(a.coefficients,a.selectedFeatures,e.numFeatures).then(e=>{r(t=>({...t,featureValues:e})),t(e=>({...e,triggerTokenVisualization:!0}))}))},[e.triggerFeatureValueCalculation,a.coefficients,a.selectedFeatures,e.numFeatures]),Object(n.useEffect)(()=>{e.triggerTokenVisualization&&(console.log("visualize tokens"),e.triggerTokenVisualization=!1,"text"===e.task?function(e,t,a,n){for(let r=0;r<""+e;r++){let e=document.getElementById("token-"+r),s=e.getElementsByClassName("inline-token")[0],o=e.getElementsByClassName("token-text")[0],i=getComputedStyle(document.documentElement),c=i.getPropertyValue("--overlay-positive-color").trim(),m=i.getPropertyValue("--overlay-negative-color").trim(),u=i.getPropertyValue("--overlay-default-color").trim(),p=i.getPropertyValue("--border-selected-color").trim();i.getPropertyValue("--border-default-color").trim();if(n)if(t.has(r))o.textContent="",o.style.visibility="hidden",s.style.backgroundColor=p+"60",s.style.border="3px solid "+p;else{o.textContent=a[r].toFixed(2),o.style.visibility="visible";var l=g(a[r],m,c,u);s.style.backgroundColor=l+"60",s.style.border="3px solid "+l,o.style.color=""+l}else o.textContent="",o.style.visibility="hidden",s.style.backgroundColor=u+"60",s.style.border="3px solid "+u}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID):"image"===e.task&&function(e,t,a,n){for(let r=0;r<""+e;r++){let e=document.getElementById("patch-"+r),s=e.querySelector("img"),o=e.getElementsByClassName("patch-overlay")[0],i=e.getElementsByClassName("patch-text")[0],c=getComputedStyle(document.documentElement),m=c.getPropertyValue("--overlay-positive-color").trim(),u=c.getPropertyValue("--overlay-negative-color").trim(),p=c.getPropertyValue("--overlay-default-color").trim(),d=c.getPropertyValue("--border-selected-color").trim(),x=c.getPropertyValue("--border-default-color").trim();if(s.style.border="4px solid "+x,n)if(t.has(r))i.textContent="",i.style.visibility="hidden",o.style.border="4px solid "+d,o.style.backgroundColor=p+"60";else{i.textContent=a[r].toFixed(2),i.style.visibility="visible";var l=g(a[r],u,m,p);o.style.border="4px solid "+l,o.style.backgroundColor=l+"80",i.style.color=""+l,i.style.backgroundColor=p+"70"}else i.textContent="",i.style.visibility="hidden",o.style.border="4px solid "+x,o.style.backgroundColor="#00000000"}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID))},[e.triggerTokenVisualization,e.task,e.numFeatures,a.selectedFeatures,a.featureValues,e.selectedPromptID]),l.a.createElement("div",{className:"App"},l.a.createElement(u,{config:e,updateConfig:(e,a)=>{t(t=>{const n={...t,[e]:a};if("task"===e){const e=n.contextData[a];n.numContexts=e.length,n.contextText=e.map(e=>e.context_title),n.selectedContextID=null,n.selectedPromptID=null,n.numPrompts=null,n.promptText=[]}if("selectedContextID"===e){const e=n.contextData[n.task][a];n.numPrompts=e.prompts.length,n.promptText=e.prompts,n.responseText=e.responses,n.selectedPromptID=null,"text"===n.task?(n.tokens=e.context.split(" "),n.numFeatures=n.tokens.length,n.numFeatureColumns=null):"image"===n.task&&(n.tokens=[],n.numFeatures=e.nx*e.ny,n.numFeatureColumns=e.nx),n.triggerTokenSet=!0,n.triggerTokenVisualization=!0}return"selectedPromptID"===e&&(n.triggerFetchCoefficients=!0),n})}}),l.a.createElement(d,{config:e,changeSelection:t=>{if(null!==e.selectedContextID&&null!==e.selectedPromptID){const e=a.selectedFeatures.has(t);r(a=>{if(null===t)return a;const n={...a,selectedFeatures:new Set(a.selectedFeatures)};return e?n.selectedFeatures.delete(t):n.selectedFeatures.add(t),n})}e.triggerFeatureValueCalculation=!0}}))};var f=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,16)).then(t=>{let{getCLS:a,getFID:n,getFCP:l,getLCP:r,getTTFB:s}=t;a(e),n(e),l(e),r(e),s(e)})};s.a.createRoot(document.getElementById("root")).render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(x,null))),f()},4:function(e,t,a){e.exports=a(15)}},[[4,1,2]]]);
//# sourceMappingURL=main.b2e46ca6.chunk.js.map