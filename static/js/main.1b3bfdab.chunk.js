(this["webpackJsonpspex-webapp-react"]=this["webpackJsonpspex-webapp-react"]||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(3),o=a.n(r);a(13),a(14);var s=function(e){let{taskType:t,updateConfig:a}=e;return l.a.createElement("div",{id:"task-container"},l.a.createElement("h3",null,"Select a Task"),l.a.createElement("div",{className:"image-selection-grid"},l.a.createElement("button",{type:"button",className:"task-button "+("image"===t?"selected":""),onClick:()=>a("task","image")},l.a.createElement("span",{role:"img","aria-label":"image"},"\ud83d\uddbc\ufe0f")," Image"),l.a.createElement("button",{type:"button",className:"task-button "+("text"===t?"selected":""),onClick:()=>a("task","text")},l.a.createElement("span",{role:"img","aria-label":"text"},"\ud83d\udcc4")," Text")))};var i=function(e){let{selectedContextId:t,numContexts:a,taskType:n,contextText:r,updateConfig:o}=e;return n?"image"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select an Image"),l.a.createElement("div",{className:"image-selection-grid",id:"image-context-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("div",{key:e,className:"context-image-button "+(t===e?"selected":""),onClick:()=>o("selectedContextID",e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${e}.png`,alt:"Option"}))))):"text"===n?l.a.createElement("div",{id:"context-container"},l.a.createElement("h3",null,"Select a Context"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"context-text-button "+(t===e?"selected":""),onClick:()=>o("selectedContextID",e)},r[e])))):null:null};var c=function(e){let{selectedPromptId:t,numPrompts:a,taskType:n,promptText:r,updateConfig:o}=e;return n&&null!==a?l.a.createElement("div",{id:"prompt-container"},l.a.createElement("h3",null,"Select a Prompt"),l.a.createElement("div",{className:"text-selection-grid"},[...Array(a).keys()].map(e=>l.a.createElement("button",{key:e,type:"button",className:"prompt-button "+(t===e?"selected":""),onClick:()=>o("selectedPromptID",e)},r[e])))):null};var u=function(e){let{config:t,updateConfig:a}=e;return l.a.createElement("div",{className:"sidebar"},l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"sunglasses"},"\ud83d\udd76\ufe0f")," SPEX"),l.a.createElement(s,{taskType:t.task,updateConfig:a}),l.a.createElement(i,{selectedContextId:t.selectedContextID,numContexts:t.numContexts,taskType:t.task,contextText:t.contextText,updateConfig:a}),l.a.createElement(c,{selectedPromptId:t.selectedPromptID,numPrompts:t.numPrompts,taskType:t.task,promptText:t.promptText,updateConfig:a}))};var m=function(e){let{config:t,changeSelection:a}=e;const{task:n,selectedContextID:r,numFeatures:o}=t;return n&&null!==r?"image"===n?l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"grid-container"},[...Array(o).keys()].map(e=>l.a.createElement("div",{key:e,className:"patch",id:"patch-"+e,onClick:()=>a(e)},l.a.createElement("img",{src:`/spex-webapp/assets/image_${r}/split_${e}.png`,alt:"Part"}),l.a.createElement("div",{className:"patch-overlay"}),l.a.createElement("div",{className:"patch-text",style:{visibility:"hidden"}}))))):"text"===n?l.a.createElement("div",{className:"main-content"},l.a.createElement("div",{className:"text-container"},[...Array(o).keys()].map(e=>l.a.createElement("div",{key:e,className:"token-wrapper",id:"token-"+e,onClick:()=>a(e),style:{visibility:"hidden"}},l.a.createElement("div",{className:"token-text"},"0"),l.a.createElement("span",{className:"inline-token"}))))):void 0:null};function d(e,t,a,n){function l(e){let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]}e=Math.max(-1,Math.min(1,e));let r,o,s,i=l(a),c=l(t),u=l(n),m=(e+1)/2;return m<.5?(m*=2,r=Math.round(c[0]+(u[0]-c[0])*m),o=Math.round(c[1]+(u[1]-c[1])*m),s=Math.round(c[2]+(u[2]-c[2])*m)):(m=2*(m-.5),r=Math.round(u[0]+(i[0]-u[0])*m),o=Math.round(u[1]+(i[1]-u[1])*m),s=Math.round(u[2]+(i[2]-u[2])*m)),function(e,t,a){return"#"+(1<<24|e<<16|t<<8|a).toString(16).slice(1).toUpperCase()}(r,o,s)}var p=function(){const[e,t]=Object(n.useState)({contextData:null,task:null,selectedContextID:null,selectedPromptID:null,numContexts:null,contextText:[],numPrompts:null,promptText:[],tokens:[],numFeatures:12,triggerTokenSet:!1,triggerFetchCoefficients:!1,triggerFeatureValueCalculation:!1,triggerTokenVisualization:!1}),[a,r]=Object(n.useState)({coefficients:null,selectedFeatures:new Set,featureValues:null});return Object(n.useEffect)(()=>{fetch("/spex-webapp/assets/config.json").then(e=>e.json()).then(e=>{t(t=>({...t,contextData:e}))})},[]),Object(n.useEffect)(()=>{e.triggerTokenSet&&(console.log("token set"),e.triggerTokenSet=!1,function(e){for(let t=0;t<""+e.length;t++){let a=document.getElementById("token-"+t);a.getElementsByClassName("inline-token")[0].textContent=e[t],a.style.visibility="visible"}}(e.tokens))},[e.triggerTokenSet,e.tokens]),Object(n.useEffect)(()=>{e.triggerFetchCoefficients&&(console.log("fetch coefficients"),e.triggerFetchCoefficients=!1,async function(e,t,a){const n=await fetch(`/spex-webapp/assets/spex/${e}/context_${t}/prompt_${a}.json`);return await n.json()}(e.task,e.selectedContextID,e.selectedPromptID).then(e=>{r(t=>({coefficients:e,selectedFeatures:new Set,featureValues:null})),t(e=>({...e,triggerFeatureValueCalculation:!0}))}))},[e.triggerFetchCoefficients,e.task,e.selectedContextID,e.selectedPromptID]),Object(n.useEffect)(()=>{e.triggerFeatureValueCalculation&&(console.log("calculate feature values"),e.triggerFeatureValueCalculation=!1,async function(e,t,a){let n=new Array(a).fill(0),l={};for(let i in e){var r="0".repeat(a).split(""),o=e[i];for(let e=0;e<a;e++)"1"===i[e]&&(t.has(e)?o*=-1:r[e]="1");l[r=r.join("")]=r in l?l[r]+o:o}for(let i in l)for(let e=0;e<a;e++)"1"===i[e]&&(n[e]+=l[i]**2);let s=Math.max(...n);return n=0!==s?n.map(e=>e/s):n.map(e=>0),n}(a.coefficients,a.selectedFeatures,e.numFeatures).then(e=>{r(t=>({...t,featureValues:e})),t(e=>({...e,triggerTokenVisualization:!0}))}))},[e.triggerFeatureValueCalculation,a.coefficients,a.selectedFeatures,e.numFeatures]),Object(n.useEffect)(()=>{e.triggerTokenVisualization&&(console.log("visualize tokens"),e.triggerTokenVisualization=!1,"text"===e.task?function(e,t,a,n){for(let r=0;r<""+e;r++){let e=document.getElementById("token-"+r),o=e.getElementsByClassName("inline-token")[0],s=e.getElementsByClassName("token-text")[0],i=getComputedStyle(document.documentElement),c=i.getPropertyValue("--overlay-positive-color").trim(),u=i.getPropertyValue("--overlay-negative-color").trim(),m=i.getPropertyValue("--overlay-default-color").trim(),p=i.getPropertyValue("--border-selected-color").trim();i.getPropertyValue("--border-default-color").trim();if(n)if(t.has(r))s.textContent="",s.style.visibility="hidden",o.style.backgroundColor=p+"60",o.style.border="3px solid "+p;else{s.textContent=a[r].toFixed(2),s.style.visibility="visible";var l=d(a[r],u,c,m);o.style.backgroundColor=l+"60",o.style.border="3px solid "+l,s.style.color=""+l}else s.textContent="",s.style.visibility="hidden",o.style.backgroundColor=m+"60",o.style.border="3px solid "+m}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID):"image"===e.task&&function(e,t,a,n){for(let r=0;r<""+e;r++){let e=document.getElementById("patch-"+r),o=e.querySelector("img"),s=e.getElementsByClassName("patch-overlay")[0],i=e.getElementsByClassName("patch-text")[0],c=getComputedStyle(document.documentElement),u=c.getPropertyValue("--overlay-positive-color").trim(),m=c.getPropertyValue("--overlay-negative-color").trim(),p=c.getPropertyValue("--overlay-default-color").trim(),g=c.getPropertyValue("--border-selected-color").trim(),y=c.getPropertyValue("--border-default-color").trim();if(n)if(t.has(r))i.textContent="",i.style.visibility="hidden",o.style.border="6px solid "+g,s.style.border="6px solid "+g,s.style.backgroundColor=p+"60";else{i.textContent=a[r].toFixed(2),i.style.visibility="visible";var l=d(a[r],m,u,p);o.style.border="6px solid "+l,s.style.border="6px solid "+l,i.style.color=""+l,s.style.backgroundColor=l+"60"}else i.textContent="",i.style.visibility="hidden",o.style.border="6px solid "+y,s.style.border="6px solid "+y,s.style.backgroundColor="#00000000"}}(e.numFeatures,a.selectedFeatures,a.featureValues,null!==e.selectedPromptID))},[e.triggerTokenVisualization,e.task,e.numFeatures,a.selectedFeatures,a.featureValues,e.selectedPromptID]),l.a.createElement("div",{className:"App"},l.a.createElement(u,{config:e,updateConfig:(e,a)=>{t(t=>{const n={...t,[e]:a};if("task"===e){const e=n.contextData[a];n.numContexts=e.length,n.contextText=e.map(e=>e.context_title),n.selectedContextID=null,n.selectedPromptID=null,n.numPrompts=null,n.promptText=[]}if("selectedContextID"===e){const e=n.contextData[n.task][a];n.numPrompts=e.prompts.length,n.promptText=e.prompts,n.selectedPromptID=null,"text"===n.task?(n.tokens=e.context.split(" "),n.numFeatures=n.tokens.length):"image"===n.task&&(n.tokens=[],n.numFeatures=12),n.triggerTokenSet=!0,n.triggerTokenVisualization=!0}return"selectedPromptID"===e&&(n.triggerFetchCoefficients=!0),n})}}),l.a.createElement(m,{config:e,changeSelection:t=>{if(null!==e.selectedContextID&&null!==e.selectedPromptID){const e=a.selectedFeatures.has(t);r(a=>{if(null===t)return a;const n={...a,selectedFeatures:new Set(a.selectedFeatures)};return e?n.selectedFeatures.delete(t):n.selectedFeatures.add(t),n})}e.triggerFeatureValueCalculation=!0}}))};var g=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,16)).then(t=>{let{getCLS:a,getFID:n,getFCP:l,getLCP:r,getTTFB:o}=t;a(e),n(e),l(e),r(e),o(e)})};o.a.createRoot(document.getElementById("root")).render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(p,null))),g()},4:function(e,t,a){e.exports=a(15)}},[[4,1,2]]]);
//# sourceMappingURL=main.1b3bfdab.chunk.js.map